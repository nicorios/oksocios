CREATE SCHEMA `oksocios-db` ;

CREATE TABLE `oksocios-db`.`socio` (
  `id_socio` INT(11) NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `dni` INT(11) NOT NULL,
  `fecha_nacimiento` DATE NULL,
  `calle` VARCHAR(254) NULL,
  `numero` INT NULL,
  `celular` INT(11) NULL,
  `email` VARCHAR(254) NULL,
  `sexo` INT NULL,
  `estado` INT NULL,
  `foto` TINYTEXT NULL,
  PRIMARY KEY (`id_socio`));

CREATE TABLE `oksocios-db`.`establecimiento` (
  `id_establecimiento` INT(11) NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `calle` VARCHAR(254) NULL,
  `numero` INT NULL,
  PRIMARY KEY (`id_establecimiento`));
ALTER TABLE `oksocios-db`.`establecimiento` 
CHANGE COLUMN `id_establecimiento` `id_establecimiento` INT(11) NOT NULL AUTO_INCREMENT ;
ALTER TABLE `oksocios-db`.`establecimiento` 
ADD COLUMN `id_administrador` INT(11) NOT NULL AFTER `numero`;


CREATE TABLE `oksocios-db`.`ingreso_socio` (
  `id_ingreso_socio` INT(11) NOT NULL AUTO_INCREMENT,
  `fecha` DATETIME NOT NULL,
  `id_establecimiento` INT(11) NOT NULL,
  `id_socio` INT(11) NOT NULL,
  PRIMARY KEY (`id_ingreso_socio`));

CREATE TABLE `oksocios-db`.`registro_socio` (
  `id_registro_socio` INT(11) NOT NULL AUTO_INCREMENT,
  `fecha` DATETIME NOT NULL,
  `id_establecimiento` INT(11) NOT NULL,
  `id_socio` INT(11) NOT NULL,
  PRIMARY KEY (`id_registro_socio`));

CREATE TABLE `oksocios-db`.`actividad` (
  `id_actividad` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `id_establecimiento` INT(11) NOT NULL,
  PRIMARY KEY (`id_actividad`));

CREATE TABLE `oksocios-db`.`suscripcion_socio` (
  `id_suscripcion_socio` INT(11) NOT NULL AUTO_INCREMENT,
  `fecha_suscripcion` DATETIME NOT NULL,
  `fecha_vencimiento` DATETIME NOT NULL,
  `id_socio` INT(11) NOT NULL,
  `id_establecimiento` INT(11) NOT NULL,
  `id_actividad` INT(11) NOT NULL,
  `monto` DOUBLE NOT NULL,
  PRIMARY KEY (`id_suscripcion_socio`));

CREATE TABLE `oksocios-db`.`administrador` (
  `id_administrador` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NULL,
  `apellido` VARCHAR(45) NULL,
  `email` VARCHAR(254) NOT NULL,
  `password` VARCHAR(254) NOT NULL,
  PRIMARY KEY (`id_administrador`));


CREATE TABLE `oksocios-db`.`empleado` (
  `id_empleado` INT(11) NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NULL,
  `apellido` VARCHAR(45) NULL,
  `email` VARCHAR(254) NOT NULL,
  `password` VARCHAR(254) NOT NULL,
  `id_establecimiento` INT(11) NOT NULL,
  PRIMARY KEY (`id_empleado`));

ALTER TABLE `oksocios-db`.`empleado` 
DROP FOREIGN KEY `fk_establecimiento`;
ALTER TABLE `oksocios-db`.`empleado` 
ADD CONSTRAINT `fk_empleado_establecimiento`
  FOREIGN KEY (`id_establecimiento`)
  REFERENCES `oksocios-db`.`establecimiento` (`id_establecimiento`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;


ALTER TABLE `oksocios-db`.`actividad` 
ADD CONSTRAINT `fk_actividad_establecimiento`
  FOREIGN KEY (`id_establecimiento`)
  REFERENCES `oksocios-db`.`establecimiento` (`id_establecimiento`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `oksocios-db`.`establecimiento` 
ADD INDEX `fk_establecimiento_administrador_idx` (`id_administrador` ASC);
ALTER TABLE `oksocios-db`.`establecimiento` 
ADD CONSTRAINT `fk_establecimiento_administrador`
  FOREIGN KEY (`id_administrador`)
  REFERENCES `oksocios-db`.`administrador` (`id_administrador`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;


ALTER TABLE `oksocios-db`.`ingreso_socio` 
ADD INDEX `fk_ingreso_socio_establecimiento_idx` (`id_establecimiento` ASC),
ADD INDEX `fk_ingreso_socio_socio_idx` (`id_socio` ASC);
ALTER TABLE `oksocios-db`.`ingreso_socio` 
ADD CONSTRAINT `fk_ingreso_socio_establecimiento`
  FOREIGN KEY (`id_establecimiento`)
  REFERENCES `oksocios-db`.`establecimiento` (`id_establecimiento`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `fk_ingreso_socio_socio`
  FOREIGN KEY (`id_socio`)
  REFERENCES `oksocios-db`.`socio` (`id_socio`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;


ALTER TABLE `oksocios-db`.`registro_socio` 
ADD INDEX `fk_registro_socio_establecimiento_idx` (`id_establecimiento` ASC),
ADD INDEX `fk_registro_socio_socio_idx` (`id_socio` ASC);
ALTER TABLE `oksocios-db`.`registro_socio` 
ADD CONSTRAINT `fk_registro_socio_establecimiento`
  FOREIGN KEY (`id_establecimiento`)
  REFERENCES `oksocios-db`.`establecimiento` (`id_establecimiento`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `fk_registro_socio_socio`
  FOREIGN KEY (`id_socio`)
  REFERENCES `oksocios-db`.`socio` (`id_socio`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `oksocios-db`.`suscripcion_socio` 
ADD INDEX `fk_suscripcion_socio_establecimiento_idx` (`id_establecimiento` ASC),
ADD INDEX `fk_suscripcion_socio_socio_idx` (`id_socio` ASC),
ADD INDEX `fk_suscripcion_socio_actividad_idx` (`id_actividad` ASC);
ALTER TABLE `oksocios-db`.`suscripcion_socio` 
ADD CONSTRAINT `fk_suscripcion_socio_establecimiento`
  FOREIGN KEY (`id_establecimiento`)
  REFERENCES `oksocios-db`.`establecimiento` (`id_establecimiento`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `fk_suscripcion_socio_socio`
  FOREIGN KEY (`id_socio`)
  REFERENCES `oksocios-db`.`socio` (`id_socio`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `fk_suscripcion_socio_actividad`
  FOREIGN KEY (`id_actividad`)
  REFERENCES `oksocios-db`.`actividad` (`id_actividad`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
